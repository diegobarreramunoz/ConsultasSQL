


SELECT
     CLIENTE."RUT_C" AS CLIENTE_RUT_C,
     CLIENTE."TELEFONO" AS CLIENTE_TELEFONO,
     CLIENTE."NOMBRE" AS CLIENTE_NOMBRE,
     CLIENTE."EMAIL" AS CLIENTE_EMAIL,
     (SELECT NOMBRE FROM TIENDA WHERE COD_TIENDA = $P{MI_COD_TIENDA}) AS MITIENDA_NOMBRE,
     (SELECT DIRECCION FROM TIENDA WHERE COD_TIENDA = $P{MI_COD_TIENDA}) AS MITIENDA_DIRECCION,
     (SELECT TELEFONO FROM TIENDA WHERE COD_TIENDA = $P{MI_COD_TIENDA}) AS MITIENDA_TELEFONO,
     TIENDA."NOMBRE" AS TIENDA_NOMBRE,
     PERSONAL."NOMBRE" AS PERSONAL_NOMBRE,
     ORDEN_TRABAJO."NUM_ORDEN" AS ORDEN_TRABAJO_NUM_ORDEN,
     ORDEN_TRABAJO."FECHA_ING" AS ORDEN_TRABAJO_FECHA_ING,
     ORDEN_TRABAJO."FECHA_ENT" AS ORDEN_TRABAJO_FECHA_ENT,
     ORDEN_TRABAJO."DESCRIP_OBSER" AS ORDEN_TRABAJO_DESCRIP_OBSER,
     ORDEN_TRABAJO."FALLA" AS ORDEN_TRABAJO_FALLA,
     ORDEN_TRABAJO."ESTADO" AS ORDEN_TRABAJO_ESTADO,
     EQUIPO."IMEI" AS EQUIPO_IMEI,
     EQUIPO."MARCA" AS EQUIPO_MARCA,
     EQUIPO."MODELO" AS EQUIPO_MODELO
FROM 	CLIENTE INNER JOIN ORDEN_TRABAJO ON CLIENTE.RUT_C = ORDEN_TRABAJO.RUT_C
	INNER JOIN TIENDA TIENDA ON ORDEN_TRABAJO.COD_TIENDA = TIENDA.COD_TIENDA
	INNER JOIN EQUIPO ON ORDEN_TRABAJO.IMEI = EQUIPO.IMEI
	INNER JOIN PERSONAL ON ORDEN_TRABAJO.RUT_P = PERSONAL.RUT_P


WHERE		TIENDA.COD_TIENDA LIKE $P{COD_TIENDA}+'%' AND
		CLIENTE.RUT_C LIKE $P{RUT_C}+'%' AND
		(ORDEN_TRABAJO.FALLA=$P{FALLA1} OR
		ORDEN_TRABAJO.FALLA=$P{FALLA2} OR
		ORDEN_TRABAJO.FALLA=$P{FALLA3} OR
		ORDEN_TRABAJO.FALLA=$P{FALLA4} OR
		ORDEN_TRABAJO.FALLA=$P{FALLA5} OR
		ORDEN_TRABAJO.FALLA=$P{FALLA6} OR
		ORDEN_TRABAJO.FALLA=$P{FALLA7}) AND
		(ORDEN_TRABAJO.ESTADO=$P{ESTADO1} OR
		ORDEN_TRABAJO.ESTADO=$P{ESTADO2} OR
		ORDEN_TRABAJO.ESTADO=$P{ESTADO3} OR
		ORDEN_TRABAJO.ESTADO=$P{ESTADO4}) AND
		((ORDEN_TRABAJO.FECHA_ING BETWEEN $P{FECHAINI1} AND $P{FECHAFIN1}) OR
		(ORDEN_TRABAJO.FECHA_ENT BETWEEN $P{FECHAINI2} AND $P{FECHAFIN2}))
ORDER BY CLIENTE.RUT_C

----------------------------------*-----------------------------------------------------











SELECT		C.NOMBRE AS NOMBRE_CLIENTE,
		C.RUT_C AS RUT_CLIENTE,
		C.EMAIL AS EMAIL_CLIENTE,
		C.TELEFONO AS TELEFONO_CLIENTE,
		O.FALLA AS FALLA,
		T.NOMBRE AS NOMBRE_TIENDA,
		T.TELEFONO AS TELEFONO_TIENDA,
		T.DIRECCION AS DIRECCION_TIENDA,
		COUNT(*) AS CANTIDAD_ORDENES,
		SUM(O.ABONO) AS SUB_TOTAL_INGRESOS,
		SUM(O.TOTAL) AS SUB_TOTAL_REFERENCIAL
FROM
ORDEN_TRABAJO O
INNER JOIN CLIENTE C ON O.RUT_C = C.RUT_C
INNER JOIN TIENDA T ON T.COD_TIENDA = O.COD_TIENDA
WHERE	((SELECT COUNT(*) FROM ORDEN_TRABAJO OT WHERE OT.RUT_C = C.RUT_C)>=$P{CANTIDAD}) AND
	(O.COD_TIENDA = $P{COD_TIENDA}) AND
	(O.FALLA=$P{FALLA1} OR
	O.FALLA=$P{FALLA2} OR
	O.FALLA=$P{FALLA3} OR
	O.FALLA=$P{FALLA4} OR
	O.FALLA=$P{FALLA5} OR
	O.FALLA=$P{FALLA6} OR
	O.FALLA=$P{FALLA7}) AND
	(O.ESTADO=$P{ESTADO1} OR
	O.ESTADO=$P{ESTADO2} OR
	O.ESTADO=$P{ESTADO3} OR
	O.ESTADO=$P{ESTADO4}) AND
	((O.FECHA_ING BETWEEN $P{FECHAINI1} AND $P{FECHAFIN1}) OR
	(O.FECHA_ENT BETWEEN $P{FECHAINI2} AND $P{FECHAFIN2}))
GROUP BY C.NOMBRE, C.RUT_C, C.EMAIL, C.TELEFONO, O.FALLA, T.NOMBRE, T.DIRECCION, T.TELEFONO
ORDER BY C.RUT_C

--------------------------------------------*--------------------------------------------------










SELECT
     REPUESTO."REPUESTO" AS REPUESTO_REPUESTO,
     REPUESTO."ESTADO" AS REPUESTO_ESTADO,
     (SELECT NOMBRE FROM TIENDA WHERE COD_TIENDA = $P{MI_COD_TIENDA}) AS MITIENDA_NOMBRE,
     (SELECT DIRECCION FROM TIENDA WHERE COD_TIENDA = $P{MI_COD_TIENDA}) AS MITIENDA_DIRECCION,
     (SELECT TELEFONO FROM TIENDA WHERE COD_TIENDA = $P{MI_COD_TIENDA}) AS MITIENDA_TELEFONO,
     TIENDA."NOMBRE" AS TIENDA_NOMBRE,
     ORDEN_TRABAJO."NUM_ORDEN" AS ORDEN_TRABAJO_NUM_ORDEN,
     ORDEN_TRABAJO."FECHA_ING" AS ORDEN_TRABAJO_FECHA_ING,
     ORDEN_TRABAJO."FECHA_ENT" AS ORDEN_TRABAJO_FECHA_ENT,
     EQUIPO."IMEI" AS EQUIPO_IMEI,
     EQUIPO."MARCA" AS EQUIPO_MARCA,
     EQUIPO."MODELO" AS EQUIPO_MODELO
FROM 	REPUESTO INNER JOIN ORDEN_TRABAJO ON REPUESTO.NUM_ORDEN = ORDEN_TRABAJO.NUM_ORDEN
	INNER JOIN TIENDA ON ORDEN_TRABAJO.COD_TIENDA = TIENDA.COD_TIENDA
	INNER JOIN EQUIPO ON ORDEN_TRABAJO.IMEI = EQUIPO.IMEI


WHERE		TIENDA.COD_TIENDA LIKE $P{COD_TIENDA}+'%' AND
		(ORDEN_TRABAJO.ESTADO=$P{ESTADO1} OR
		ORDEN_TRABAJO.ESTADO=$P{ESTADO2} OR
		ORDEN_TRABAJO.ESTADO=$P{ESTADO3} OR
		ORDEN_TRABAJO.ESTADO=$P{ESTADO4}) AND
		((ORDEN_TRABAJO.FECHA_ING BETWEEN $P{FECHAINI1} AND $P{FECHAFIN1}) OR
		(ORDEN_TRABAJO.FECHA_ENT BETWEEN $P{FECHAINI2} AND $P{FECHAFIN2})) AND
		(REPUESTO.ESTADO = $P{REPUESTO_ESTADO_1} OR REPUESTO.ESTADO = $P{REPUESTO_ESTADO_2})
ORDER BY  ORDEN_TRABAJO.NUM_ORDEN

------------------------------------------------*-----------------------------------------------------








SELECT
     ORDEN_TRABAJO."NUM_ORDEN" AS ORDEN_TRABAJO_NUM_ORDEN,
     ORDEN_TRABAJO."FECHA_ING" AS ORDEN_TRABAJO_FECHA_ING,
     ORDEN_TRABAJO."FECHA_ENT" AS ORDEN_TRABAJO_FECHA_ENT,
     ORDEN_TRABAJO."REPUESTOS" AS ORDEN_TRABAJO_REPUESTOS,
     TIENDA."DIRECCION" AS TIENDA_DIRECCION,
     TIENDA."TELEFONO" AS TIENDA_TELEFONO,
     TIENDA."NOMBRE" AS TIENDA_NOMBRE,
     EQUIPO."MARCA" AS EQUIPO_MARCA,
     EQUIPO."MODELO" AS EQUIPO_MODELO,
     ORDEN_TRABAJO."IMEI" AS ORDEN_TRABAJO_IMEI,
     ORDEN_TRABAJO."COD_TIENDA" AS ORDEN_TRABAJO_COD_TIENDA
FROM
     "dbo"."TIENDA" TIENDA INNER JOIN "dbo"."ORDEN_TRABAJO" ORDEN_TRABAJO ON TIENDA."COD_TIENDA" = ORDEN_TRABAJO."COD_TIENDA"
     INNER JOIN "dbo"."EQUIPO" EQUIPO ON ORDEN_TRABAJO."IMEI" = EQUIPO."IMEI"
WHERE
     ORDEN_TRABAJO."FECHA_ING" BETWEEN $P{fechaini} AND $P{fechaterm}
 AND ORDEN_TRABAJO."COD_TIENDA" = $P{cod_tienda}
 AND ORDEN_TRABAJO."ESTADO_REPUE" = 'No Existe'
 AND (ORDEN_TRABAJO."ESTADO" = $P{estado1} or ORDEN_TRABAJO."ESTADO" = $P{estado2} or ORDEN_TRABAJO."ESTADO" = $P{estado3})
ORDER BY
     ORDEN_TRABAJO."FECHA_ENT"